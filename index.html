<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>목차 도구 통합 페이지</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 24px 48px rgba(0,0,0,0.12);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.4em;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
            font-weight: 400;
        }

        .tab-navigation {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab-button {
            flex: 1;
            background: none;
            border: none;
            padding: 20px 30px;
            font-size: 1.1em;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #f1f5f9;
            color: #334155;
        }

        .tab-button.active {
            color: #2c3e50;
            background: white;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 50px 40px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 색지 페이지 생성기 스타일 */
        .color-page-generator .input-section {
            background: #f8fafc;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid #e2e8f0;
        }

        .color-page-generator .input-group {
            margin-bottom: 32px;
        }

        .color-page-generator .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1e293b;
            font-size: 1.1em;
            letter-spacing: -0.01em;
        }

        .color-page-generator .input-group textarea {
            width: 100%;
            min-height: 220px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-family: 'Pretendard', monospace;
            font-size: 15px;
            line-height: 1.7;
            resize: vertical;
            transition: all 0.3s ease;
            background: white;
        }

        .color-page-generator .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .color-page-generator .input-group input[type="number"] {
            width: 180px;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: white;
        }

        .color-page-generator .input-group input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .color-page-generator .button-group {
            text-align: center;
            margin: 40px 0;
        }

        .color-page-generator .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 36px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
            letter-spacing: -0.01em;
        }

        .color-page-generator .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }

        .color-page-generator .results-section {
            background: #ffffff;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            margin-top: 40px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .color-page-generator .results-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 24px 30px;
            font-weight: 700;
            font-size: 1.2em;
            letter-spacing: -0.01em;
        }

        .color-page-generator .results-content {
            padding: 40px;
        }

        .color-page-generator .result-item {
            background: #f8fafc;
            border-left: 5px solid #667eea;
            padding: 24px;
            margin-bottom: 20px;
            border-radius: 0 12px 12px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.2s ease;
        }

        .color-page-generator .result-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .color-page-generator .result-item h3 {
            color: #1e293b;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .color-page-generator .page-info {
            font-family: 'Pretendard', monospace;
            background: #e2e8f0;
            padding: 16px 20px;
            border-radius: 8px;
            margin-top: 12px;
            font-weight: 600;
            color: #475569;
            line-height: 1.5;
        }

        .color-page-generator .summary-section {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1f2937;
            padding: 30px;
            border-radius: 16px;
            margin-top: 24px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
        }

        .color-page-generator .copy-section {
            text-align: center;
            margin-top: 24px;
        }

        .color-page-generator .copy-btn {
            background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 16px rgba(236, 72, 153, 0.3);
            letter-spacing: -0.01em;
        }

        .color-page-generator .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(236, 72, 153, 0.4);
        }

        .color-page-generator .example {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
            font-size: 14px;
            color: #1e40af;
        }

        .color-page-generator .example-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: #1e40af;
            font-size: 15px;
        }

        .color-page-generator .subtitle {
            color: #64748b;
            font-style: italic;
            margin: 8px 0;
            font-size: 0.95em;
            padding-left: 4px;
        }

        .color-page-generator .hidden {
            display: none;
        }

        /* 목차 비교 분석기 스타일 */
        .toc-analyzer .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .toc-analyzer .input-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .toc-analyzer .input-box:focus-within {
            border-color: #2c3e50;
        }

        .toc-analyzer .input-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 12px;
            color: #495057;
        }

        .toc-analyzer .textarea {
            width: 100%;
            height: 200px;
            padding: 14px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-family: 'Pretendard', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
            outline: none;
        }

        .toc-analyzer .textarea:focus {
            border-color: #2c3e50;
            box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.1);
        }

        .toc-analyzer .count {
            margin-top: 8px;
            font-size: 0.85em;
            color: #6c757d;
            font-weight: 500;
        }

        .toc-analyzer .compare-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .toc-analyzer .compare-btn {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 6px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toc-analyzer .compare-btn:hover {
            background: #34495e;
        }

        .toc-analyzer .compare-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .toc-analyzer .results {
            display: none;
        }

        .toc-analyzer .results.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .toc-analyzer .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .toc-analyzer .filter-group {
            display: flex;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }

        .toc-analyzer .filter-btn {
            padding: 10px 20px;
            border: none;
            background: white;
            color: #6c757d;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9em;
        }

        .toc-analyzer .filter-btn.active {
            background: #2c3e50;
            color: white;
        }

        .toc-analyzer .filter-btn:hover:not(.active) {
            background: #f8f9fa;
        }

        .toc-analyzer .summary-stats {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 0 auto;
            flex: 1;
            max-width: 600px;
        }

        .toc-analyzer .stat-card {
            background: white;
            padding: 12px 16px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s;
            min-width: 80px;
            flex: 1;
        }

        .toc-analyzer .stat-card:hover {
            transform: translateY(-2px);
        }

        .toc-analyzer .stat-card.total { border-left-color: #007bff; }
        .toc-analyzer .stat-card.added { border-left-color: #28a745; }
        .toc-analyzer .stat-card.deleted { border-left-color: #dc3545; }
        .toc-analyzer .stat-card.modified { border-left-color: #ffc107; }
        .toc-analyzer .stat-card.urgent { border-left-color: #dc3545; background: #fff5f5; }

        .toc-analyzer .stat-number {
            font-size: 1.6em;
            font-weight: 700;
            margin-bottom: 3px;
            color: #495057;
        }

        .toc-analyzer .stat-label {
            font-size: 0.75em;
            color: #6c757d;
            font-weight: 500;
        }

        .toc-analyzer .copy-btn {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .toc-analyzer .copy-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .toc-analyzer .results-list {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 8px;
        }

        .toc-analyzer .results-list::-webkit-scrollbar {
            width: 6px;
        }

        .toc-analyzer .results-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }

        .toc-analyzer .results-list::-webkit-scrollbar-thumb {
            background: #4facfe;
            border-radius: 8px;
        }

        .toc-analyzer .result-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }

        .toc-analyzer .result-row:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .toc-analyzer .status-indicator {
            width: 6px;
            height: 80px;
            min-height: 80px;
        }

        .toc-analyzer .status-indicator.added { background: #28a745; }
        .toc-analyzer .status-indicator.deleted { background: #dc3545; }
        .toc-analyzer .status-indicator.modified { background: #ffc107; }
        .toc-analyzer .status-indicator.page-changed { background: #007bff; }
        .toc-analyzer .status-indicator.unchanged { background: #6c757d; }

        .toc-analyzer .content-main {
            flex: 1;
            padding: 16px 20px;
        }

        .toc-analyzer .content-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
            line-height: 1.4;
        }

        .toc-analyzer .content-subtitle {
            font-size: 0.9em;
            color: #6c757d;
            line-height: 1.3;
        }

        .toc-analyzer .content-before,
        .toc-analyzer .content-after {
            display: block;
            margin-bottom: 4px;
            padding: 4px 0;
        }

        .toc-analyzer .content-before {
            color: #dc3545;
            text-decoration: line-through;
        }

        .toc-analyzer .content-after {
            color: #28a745;
        }

        .toc-analyzer .content-single {
            color: #2c3e50;
        }

        .toc-analyzer .content-single.deleted {
            color: #dc3545;
            text-decoration: line-through;
        }

        .toc-analyzer .status-badge {
            padding: 8px 16px;
            margin-right: 16px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-align: center;
            min-width: 60px;
            color: white;
        }

        .toc-analyzer .status-badge.added { background: #28a745; }
        .toc-analyzer .status-badge.deleted { background: #dc3545; }
        .toc-analyzer .status-badge.modified { background: #ffc107; color: #1a1a1a; }
        .toc-analyzer .status-badge.page-changed { background: #007bff; }
        .toc-analyzer .status-badge.unchanged { background: #6c757d; }

        .toc-analyzer .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .toc-analyzer .no-results-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .toc-analyzer .no-results-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 16px;
            }

            .tab-content {
                padding: 30px 20px;
            }

            .tab-button {
                padding: 16px 20px;
                font-size: 1em;
            }

            .color-page-generator .input-section,
            .color-page-generator .results-content {
                padding: 30px 20px;
            }

            .toc-analyzer .input-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .toc-analyzer .controls {
                flex-direction: column;
                gap: 15px;
            }

            .toc-analyzer .summary-stats {
                max-width: 100%;
            }

            .toc-analyzer .stat-card {
                min-width: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📚 목차 도구 모음</h1>
            <p>목차 관련 작업을 위한 전문 도구들</p>
        </div>

        <div class="tab-navigation">
            <button class="tab-button active" id="colorPageBtn">
                📖 색지 페이지 생성기
            </button>
            <button class="tab-button" id="tocAnalyzerBtn">
                📋 목차 비교 분석기
            </button>
        </div>

        <!-- 색지 페이지 생성기 -->
        <div id="colorPageTab" class="tab-content active color-page-generator">
            <div class="input-section">
                <div class="input-group">
                    <label for="tocInput">목차 내용 입력:</label>
                    <textarea id="tocInput" placeholder="목차를 입력하세요...&#10;예시:&#10;1. 대한민국산업현장교수 사업 ··························································· 1&#10;2. 직업능력개발주치의 사업 ······························································· 9"></textarea>
                    <div class="example">
                        <div class="example-title">입력 형식 예시:</div>
                        <div>1. 챕터명 ············································ 1</div>
                        <div>2. 챕터명 ············································ 9</div>
                        <div>- 부제목</div>
                        <div>3. 챕터명 ············································ 21</div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="extraPages">목차에 포함되지 않는 페이지 수 (표지, 서문 등):</label>
                    <input type="number" id="extraPages" placeholder="0" min="0">
                </div>

                <div class="button-group">
                    <button class="btn" id="generateBtn">색지 페이지 생성</button>
                </div>
            </div>

            <div id="results" class="results-section hidden">
                <div class="results-header">
                    📋 생성된 색지 페이지 정보
                </div>
                <div class="results-content" id="resultsContent">
                </div>
            </div>
        </div>

        <!-- 목차 비교 분석기 -->
        <div id="tocAnalyzerTab" class="tab-content toc-analyzer">
            <div class="input-section">
                <div class="input-box">
                    <div class="input-title">📄 기존 목차</div>
                    <textarea id="oldTOC" class="textarea" placeholder="기존 목차를 여기에 붙여넣어주세요.

예시:
제1장 서론 ........................... 1
제2장 이론적 배경 .................... 15
  2.1 선행연구 ....................... 16
  2.2 연구모형 ....................... 25
제3장 연구방법 ....................... 35"></textarea>
                    <div class="count" id="oldCount">0줄</div>
                </div>
                <div class="input-box">
                    <div class="input-title">📝 새로운 목차</div>
                    <textarea id="newTOC" class="textarea" placeholder="새로운 목차를 여기에 붙여넣어주세요.

예시:
제1장 서론 ........................... 1
제2장 이론적 배경 및 선행연구 ........ 15
  2.1 선행연구 검토 .................. 16
  2.2 연구모형 설정 .................. 25
제3장 연구방법론 ..................... 35
제4장 연구결과 ....................... 50"></textarea>
                    <div class="count" id="newCount">0줄</div>
                </div>
            </div>
            <div class="compare-section">
                <button class="compare-btn" id="compareBtn">🔍 목차 비교 분석 시작</button>
            </div>
            <div class="results" id="analyzerResults">
                <div class="controls">
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="changes">변경사항</button>
                        <button class="filter-btn" data-filter="all">전체</button>
                        <button class="filter-btn" data-filter="urgent">긴급검토</button>
                    </div>
                    <div class="summary-stats">
                        <div class="stat-card total"><div class="stat-number" id="totalCount">0</div><div class="stat-label">총 항목</div></div>
                        <div class="stat-card added"><div class="stat-number" id="addedCount">0</div><div class="stat-label">➕ 추가</div></div>
                        <div class="stat-card deleted"><div class="stat-number" id="deletedCount">0</div><div class="stat-label">➖ 삭제</div></div>
                        <div class="stat-card modified"><div class="stat-number" id="modifiedCount">0</div><div class="stat-label">✏️ 수정</div></div>
                        <div class="stat-card urgent"><div class="stat-number" id="urgentCount">0</div><div class="stat-label">🚨 긴급</div></div>
                    </div>
                    <button class="copy-btn" id="copyAnalyzerBtn">📋 결과 복사</button>
                </div>
                <div class="results-list" id="resultsList"></div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        var analysisResults = [];
        var currentFilter = 'changes';

        // DOM이 로드되면 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로드 완료');
            
            // 탭 전환 버튼 이벤트 리스너
            var colorPageBtn = document.getElementById('colorPageBtn');
            var tocAnalyzerBtn = document.getElementById('tocAnalyzerBtn');
            
            if (colorPageBtn) {
                colorPageBtn.addEventListener('click', function() {
                    switchTab('colorPage');
                });
            }
            
            if (tocAnalyzerBtn) {
                tocAnalyzerBtn.addEventListener('click', function() {
                    switchTab('tocAnalyzer');
                });
            }

            // 색지 페이지 생성기 이벤트 리스너
            var generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.addEventListener('click', generateColorPages);
            }

            // 목차 비교 분석기 이벤트 리스너
            var oldTOC = document.getElementById('oldTOC');
            var newTOC = document.getElementById('newTOC');
            var compareBtn = document.getElementById('compareBtn');
            var copyAnalyzerBtn = document.getElementById('copyAnalyzerBtn');
            
            if (oldTOC) {
                oldTOC.addEventListener('input', function() {
                    updateLineCount('oldTOC', 'oldCount');
                });
                updateLineCount('oldTOC', 'oldCount');
            }
            
            if (newTOC) {
                newTOC.addEventListener('input', function() {
                    updateLineCount('newTOC', 'newCount');
                });
                updateLineCount('newTOC', 'newCount');
            }
            
            if (compareBtn) {
                compareBtn.addEventListener('click', startComparison);
            }
            
            if (copyAnalyzerBtn) {
                copyAnalyzerBtn.addEventListener('click', copyAnalyzerResults);
            }

            // 필터 버튼 이벤트 리스너
            var filterBtns = document.querySelectorAll('.toc-analyzer .filter-btn');
            filterBtns.forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    setFilter(e.target.dataset.filter);
                });
            });
            
            console.log('모든 이벤트 리스너 등록 완료');
        });

        // 탭 전환 함수
        function switchTab(tabName) {
            console.log('탭 전환:', tabName);
            
            // 모든 탭 버튼 비활성화
            var tabButtons = document.querySelectorAll('.tab-button');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            // 모든 탭 컨텐츠 숨기기
            var tabContents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // 선택된 탭 활성화
            if (tabName === 'colorPage') {
                document.getElementById('colorPageBtn').classList.add('active');
                document.getElementById('colorPageTab').classList.add('active');
            } else if (tabName === 'tocAnalyzer') {
                document.getElementById('tocAnalyzerBtn').classList.add('active');
                document.getElementById('tocAnalyzerTab').classList.add('active');
            }
        }

        // 색지 페이지 생성기 함수들
        function generateColorPages() {
            var tocInput = document.getElementById('tocInput').value.trim();
            var extraPages = parseInt(document.getElementById('extraPages').value) || 0;
            
            if (!tocInput) {
                alert('목차 내용을 입력해주세요.');
                return;
            }

            try {
                var chapters = parseTOC(tocInput);
                var colorPages = calculateColorPages(chapters, extraPages);
                displayResults(colorPages, chapters, extraPages);
            } catch (error) {
                alert('목차 분석 중 오류가 발생했습니다: ' + error.message);
            }
        }

        function parseTOC(tocText) {
            var lines = tocText.split('\n').filter(function(line) { return line.trim(); });
            var chapters = [];
            var currentChapter = null;

            for (var i = 0; i < lines.length; i++) {
                var line = lines[i];
                var trimmedLine = line.trim();
                
                var pageMatch = trimmedLine.match(/.*?(\d+)\s*$/);
                
                if (pageMatch) {
                    var pageNumber = parseInt(pageMatch[1]);
                    var title = trimmedLine.replace(/\s*[·\.\s]*\s*\d+\s*$/, '').trim();
                    
                    var chapterMatch = title.match(/^(\d+)\.\s*(.+)/);
                    
                    if (chapterMatch) {
                        currentChapter = {
                            number: parseInt(chapterMatch[1]),
                            title: chapterMatch[2].trim(),
                            page: pageNumber,
                            subtitles: []
                        };
                        chapters.push(currentChapter);
                    } else {
                        currentChapter = {
                            number: chapters.length + 1,
                            title: title,
                            page: pageNumber,
                            subtitles: []
                        };
                        chapters.push(currentChapter);
                    }
                } else if (trimmedLine.startsWith('-') && currentChapter) {
                    var subtitle = trimmedLine.substring(1).trim();
                    currentChapter.subtitles.push(subtitle);
                }
            }

            if (chapters.length === 0) {
                throw new Error('페이지 번호가 포함된 목차 항목을 찾을 수 없습니다.');
            }

            return chapters;
        }

        function calculateColorPages(chapters, extraPages) {
            var colorPages = [];

            for (var i = 0; i < chapters.length; i++) {
                var chapter = chapters[i];
                var tocColorPage = chapter.page;
                var actualColorPage = tocColorPage + extraPages;
                
                colorPages.push({
                    colorPage: actualColorPage,
                    chapterTitle: chapter.title,
                    chapterNumber: chapter.number,
                    tocColorPage: tocColorPage,
                    subtitles: chapter.subtitles
                });
            }

            return colorPages;
        }

        function displayResults(colorPages, chapters, extraPages) {
            var resultsContent = document.getElementById('resultsContent');
            var results = document.getElementById('results');
            
            var html = '';
            var colorPageNumbers = colorPages.map(function(item) { return item.colorPage; }).sort(function(a, b) { return a - b; });
            
            // 요약 정보를 맨 위에 배치
            html += '<div class="summary-section">';
            html += '<h3>📊 요약 정보</h3>';
            html += '<p><strong>전체 챕터 수:</strong> ' + chapters.length + '개</p>';
            html += '<p><strong>추가 페이지 수:</strong> ' + extraPages + '페이지</p>';
            html += '<p id="colorPageResult"><strong>간지페이지(PDF):</strong> ' + colorPageNumbers.join(', ') + ' (총 ' + colorPageNumbers.length + '페이지)</p>';
            html += '<div style="text-align: center; margin-top: 15px;">';
            html += '<button onclick="copyColorPageResult()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border: none; border-radius: 20px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); margin-right: 10px;" onmouseover="this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 6px 18px rgba(102, 126, 234, 0.4)\'" onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 4px 12px rgba(102, 126, 234, 0.3)\'">📋 페이지 번호만 복사</button>';
            html += '<button onclick="copyResults()" style="background: linear-gradient(135deg, #ec4899 0%, #be185d 100%); color: white; padding: 10px 20px; border: none; border-radius: 20px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 6px 16px rgba(236, 72, 153, 0.3);" onmouseover="this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 8px 24px rgba(236, 72, 153, 0.4)\'" onmouseout="this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 6px 16px rgba(236, 72, 153, 0.3)\'">📋 전체 결과 복사</button>';
            html += '</div>';
            html += '</div>';

            // 상세 결과는 아래에 배치
            html += '<div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0;">';
            html += '<h3 style="color: #1e293b; font-size: 1.3em; margin-bottom: 20px; font-weight: 600;">📋 상세 결과</h3>';

            for (var i = 0; i < colorPages.length; i++) {
                var item = colorPages[i];
                html += '<div class="result-item">';
                html += '<h3>' + item.chapterNumber + '. ' + item.chapterTitle + '</h3>';
                if (item.subtitles.length > 0) {
                    html += '<div class="subtitle">└ ' + item.subtitles.join(', ') + '</div>';
                }
                html += '<div class="page-info">';
                html += '목차 기준 색지: ' + item.tocColorPage + '페이지<br>';
                html += '실제 PDF 색지: ' + item.colorPage + '페이지';
                html += '</div>';
                html += '</div>';
            }
            
            html += '</div>';

            resultsContent.innerHTML = html;
            results.classList.remove('hidden');
            
            // 요약 정보로 부드럽게 스크롤
            setTimeout(function() {
                results.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function copyResults() {
            var colorPageNumbers = [];
            
            // 결과에서 색지 페이지 번호 추출
            var resultElement = document.getElementById('colorPageResult');
            if (resultElement) {
                // 전체 텍스트를 그대로 복사 (총 페이지 개수 포함)
                var fullText = resultElement.textContent;
                var copyText = fullText.replace('간지페이지(PDF): ', '간지페이지(PDF): ');
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(copyText).then(function() {
                        // 버튼 텍스트 임시 변경으로 피드백
                        var button = event.target;
                        var originalText = button.textContent;
                        button.textContent = '✅ 복사완료!';
                        button.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                        
                        setTimeout(function() {
                            button.textContent = originalText;
                            button.style.background = 'linear-gradient(135deg, #ec4899 0%, #be185d 100%)';
                        }, 1500);
                    }).catch(function() {
                        fallbackCopy(copyText);
                    });
                } else {
                    fallbackCopy(copyText);
                }
            } else {
                alert('복사할 결과가 없습니다.');
            }
        }

        function fallbackCopy(text) {
            var textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('결과가 클립보드에 복사되었습니다!');
        }

        // 간지페이지 결과만 복사하는 함수
        function copyColorPageResult() {
            var resultElement = document.getElementById('colorPageResult');
            if (!resultElement) {
                alert('복사할 결과가 없습니다.');
                return;
            }
            
            // 페이지 번호만 추출 (7, 15, 27, 35, 45 형태)
            var fullText = resultElement.textContent;
            var pageNumbers = fullText.match(/간지페이지\(PDF\):\s*([0-9,\s]+)/);
            var copyText = pageNumbers ? pageNumbers[1].trim() : '';
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(copyText).then(function() {
                    // 버튼 텍스트 임시 변경으로 피드백
                    var button = event.target;
                    var originalText = button.textContent;
                    button.textContent = '✅ 복사완료!';
                    button.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                    
                    setTimeout(function() {
                        button.textContent = originalText;
                        button.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }, 1500);
                }).catch(function() {
                    fallbackCopy(copyText);
                });
            } else {
                fallbackCopy(copyText);
            }
        }

        // 목차 비교 분석기 함수들
        function updateLineCount(textareaId, countId) {
            var textarea = document.getElementById(textareaId);
            var countElement = document.getElementById(countId);
            if (textarea && countElement) {
                var lines = textarea.value.split('\n').filter(function(line) { return line.trim().length > 0; });
                countElement.textContent = lines.length + '줄';
            }
        }

        function parseTOCForAnalysis(text) {
            if (!text.trim()) return [];
            var lines = text.split('\n')
                .map(function(line) { return line.trim(); })
                .filter(function(line) { return line.length > 0; });
            
            return lines.map(function(line, index) {
                var trimmed = line.trim();
                var indent = line.length - line.trimStart().length;
                var level = Math.floor(indent / 2);
                var patterns = [/^(.+?)\s*[\.]{2,}\s*(\d+)$/, /^(.+?)\s{3,}(\d+)$/, /^(.+?)\t+(\d+)$/, /^(.+?)\s*\((\d+)\)$/, /^(.+?)\s*[-~]\s*(\d+)$/];
                var title = '', page = '';
                for (var i = 0; i < patterns.length; i++) {
                    var match = trimmed.match(patterns[i]);
                    if (match) { 
                        title = match[1].trim(); 
                        page = match[2]; 
                        break; 
                    }
                }
                if (!title) title = trimmed;
                title = title.replace(/^[\d\.\-\s]*/, '').trim().replace(/[\.]{2,}$/, '').trim();
                return { index: index, title: title, page: page, level: level, original: trimmed };
            });
        }

        function calculateSimilarity(str1, str2) {
            if (str1 === str2) return 1.0;
            var longer = str1.length > str2.length ? str1 : str2;
            var shorter = str1.length > str2.length ? str2 : str1;
            if (longer.length === 0) return 1.0;
            var distance = levenshteinDistance(longer, shorter);
            return (longer.length - distance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            var matrix = [];
            for (var i = 0; i <= str2.length; i++) {
                matrix[i] = [];
                for (var j = 0; j <= str1.length; j++) {
                    matrix[i][j] = 0;
                }
            }
            
            for (var i = 0; i <= str1.length; i++) matrix[0][i] = i;
            for (var j = 0; j <= str2.length; j++) matrix[j][0] = j;
            
            for (var j = 1; j <= str2.length; j++) {
                for (var i = 1; i <= str1.length; i++) {
                    if (str1[i - 1] === str2[j - 1]) {
                        matrix[j][i] = matrix[j - 1][i - 1];
                    } else {
                        matrix[j][i] = Math.min(
                            matrix[j - 1][i - 1] + 1,
                            matrix[j][i - 1] + 1,
                            matrix[j - 1][i] + 1
                        );
                    }
                }
            }
            return matrix[str2.length][str1.length];
        }

        function compareItems(oldItems, newItems) {
            var results = [];
            var usedOld = [];
            var usedNew = [];
            
            // 완전히 일치하는 항목들 매칭
            for (var oldIndex = 0; oldIndex < oldItems.length; oldIndex++) {
                if (oldIndex < newItems.length) {
                    var oldItem = oldItems[oldIndex];
                    var newItem = newItems[oldIndex];
                    if (oldItem.title === newItem.title) {
                        usedOld[oldIndex] = true;
                        usedNew[oldIndex] = true;
                        var changes = [];
                        if (oldItem.page !== newItem.page && oldItem.page && newItem.page) {
                            changes.push('페이지 ' + oldItem.page + ' → ' + newItem.page);
                        }
                        results.push({ 
                            type: changes.length > 0 ? 'page-changed' : 'unchanged', 
                            oldItem: oldItem, 
                            newItem: newItem, 
                            changes: changes, 
                            severity: 'low', 
                            position: oldIndex 
                        });
                    }
                }
            }
            
            // 유사한 항목들 매칭
            for (var oldIndex = 0; oldIndex < oldItems.length; oldIndex++) {
                if (usedOld[oldIndex]) continue;
                
                var bestMatch = null;
                var bestSimilarity = 0;
                var bestNewIndex = -1;
                
                for (var newIndex = 0; newIndex < newItems.length; newIndex++) {
                    if (usedNew[newIndex]) continue;
                    
                    var similarity = calculateSimilarity(
                        oldItems[oldIndex].title.toLowerCase(), 
                        newItems[newIndex].title.toLowerCase()
                    );
                    
                    if (similarity > bestSimilarity && similarity > 0.7) {
                        bestMatch = newItems[newIndex];
                        bestSimilarity = similarity;
                        bestNewIndex = newIndex;
                    }
                }
                
                if (bestMatch) {
                    usedOld[oldIndex] = true;
                    usedNew[bestNewIndex] = true;
                    var changes = ['내용 수정'];
                    results.push({ 
                        type: 'modified', 
                        oldItem: oldItems[oldIndex], 
                        newItem: bestMatch, 
                        changes: changes, 
                        severity: 'medium', 
                        position: Math.min(oldIndex, bestNewIndex) 
                    });
                }
            }
            
            // 삭제된 항목들
            for (var oldIndex = 0; oldIndex < oldItems.length; oldIndex++) {
                if (!usedOld[oldIndex]) {
                    results.push({ 
                        type: 'deleted', 
                        oldItem: oldItems[oldIndex], 
                        newItem: null, 
                        changes: ['삭제됨'], 
                        severity: 'high', 
                        position: oldIndex 
                    });
                }
            }
            
            // 추가된 항목들
            for (var newIndex = 0; newIndex < newItems.length; newIndex++) {
                if (!usedNew[newIndex]) {
                    results.push({ 
                        type: 'added', 
                        oldItem: null, 
                        newItem: newItems[newIndex], 
                        changes: ['새로 추가됨'], 
                        severity: 'medium', 
                        position: newIndex 
                    });
                }
            }
            
            return results.sort(function(a, b) { return a.position - b.position; });
        }

        function startComparison() {
            var oldTOC = document.getElementById('oldTOC');
            var newTOC = document.getElementById('newTOC');
            var compareBtn = document.getElementById('compareBtn');
            
            var oldText = oldTOC.value;
            var newText = newTOC.value;
            
            if (!oldText.trim() || !newText.trim()) { 
                alert('기존 목차와 새로운 목차를 모두 입력해주세요.'); 
                return; 
            }
            
            compareBtn.disabled = true;
            compareBtn.textContent = '🔄 분석중...';
            
            setTimeout(function() {
                try {
                    var oldItems = parseTOCForAnalysis(oldText);
                    var newItems = parseTOCForAnalysis(newText);
                    analysisResults = compareItems(oldItems, newItems);
                    displayAnalysisResults();
                } catch (error) {
                    console.error('분석 중 오류 발생:', error);
                    alert('분석 중 오류가 발생했습니다: ' + error.message);
                } finally {
                    compareBtn.disabled = false;
                    compareBtn.textContent = '🔍 목차 비교 분석 시작';
                }
            }, 500);
        }

        function displayAnalysisResults() {
            var resultsDiv = document.getElementById('analyzerResults');
            resultsDiv.classList.add('show');
            
            var stats = {
                total: analysisResults.length,
                added: 0,
                deleted: 0,
                modified: 0,
                urgent: 0
            };
            
            for (var i = 0; i < analysisResults.length; i++) {
                var result = analysisResults[i];
                if (result.type === 'added') stats.added++;
                if (result.type === 'deleted') stats.deleted++;
                if (result.type === 'modified' || result.type === 'page-changed') stats.modified++;
                if (result.severity === 'high') stats.urgent++;
            }
            
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('addedCount').textContent = stats.added;
            document.getElementById('deletedCount').textContent = stats.deleted;
            document.getElementById('modifiedCount').textContent = stats.modified;
            document.getElementById('urgentCount').textContent = stats.urgent;
            
            updateResultsList();
        }

        function setFilter(filter) {
            currentFilter = filter;
            var filterBtns = document.querySelectorAll('.toc-analyzer .filter-btn');
            for (var i = 0; i < filterBtns.length; i++) {
                filterBtns[i].classList.remove('active');
            }
            var targetBtn = document.querySelector('.toc-analyzer [data-filter="' + filter + '"]');
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            updateResultsList();
        }

        function updateResultsList() {
            var resultsListDiv = document.getElementById('resultsList');
            var filteredResults = analysisResults;
            
            if (currentFilter === 'changes') {
                filteredResults = analysisResults.filter(function(r) { return r.type !== 'unchanged'; });
            } else if (currentFilter === 'urgent') {
                filteredResults = analysisResults.filter(function(r) { return r.severity === 'high'; });
            }
            
            if (filteredResults.length === 0) {
                resultsListDiv.innerHTML = '<div class="no-results"><div class="no-results-icon">✅</div><div class="no-results-title">표시할 항목이 없습니다</div></div>';
                return;
            }
            
            var html = '';
            var typeLabels = {
                'added': '추가',
                'deleted': '삭제', 
                'modified': '수정',
                'page-changed': '페이지',
                'unchanged': '동일'
            };
            
            for (var i = 0; i < filteredResults.length; i++) {
                var result = filteredResults[i];
                var mainContent = '';
                var subContent = '';
                
                if (result.type === 'added') {
                    mainContent = '<span class="content-single">' + result.newItem.original + '</span>';
                    subContent = '새로 추가된 항목입니다';
                } else if (result.type === 'deleted') {
                    mainContent = '<span class="content-single deleted">' + result.oldItem.original + '</span>';
                    subContent = '삭제된 항목입니다';
                } else if (result.type === 'modified' || result.type === 'page-changed') {
                    mainContent = '<span class="content-before">' + result.oldItem.original + '</span><span class="content-after">' + result.newItem.original + '</span>';
                    subContent = result.changes ? result.changes.join(' • ') : '내용이 수정되었습니다';
                } else {
                    mainContent = '<span class="content-single">' + result.oldItem.original + '</span>';
                    subContent = '변경사항이 없습니다';
                }
                
                html += '<div class="result-row">';
                html += '<div class="status-indicator ' + result.type + '"></div>';
                html += '<div class="content-main">';
                html += '<div class="content-title">' + mainContent + '</div>';
                html += '<div class="content-subtitle">' + subContent + '</div>';
                html += '</div>';
                html += '<div class="status-badge ' + result.type + '">' + typeLabels[result.type] + '</div>';
                html += '</div>';
            }
            
            resultsListDiv.innerHTML = html;
        }

        function copyAnalyzerResults() {
            if (analysisResults.length === 0) { 
                alert('비교 결과가 없습니다.'); 
                return; 
            }
            
            var filteredResults = analysisResults;
            var filterLabel = '전체';
            
            if (currentFilter === 'changes') {
                filteredResults = analysisResults.filter(function(r) { return r.type !== 'unchanged'; });
                filterLabel = '변경사항';
            } else if (currentFilter === 'urgent') {
                filteredResults = analysisResults.filter(function(r) { return r.severity === 'high'; });
                filterLabel = '긴급검토';
            }
            
            if (filteredResults.length === 0) {
                alert('현재 필터에 해당하는 결과가 없습니다.');
                return;
            }
            
            var text = '목차 비교 분석 결과 (' + filterLabel + ')\n생성일시: ' + new Date().toLocaleString('ko-KR') + '\n\n';
            
            var typeLabels = { 
                'added': '➕ 추가됨', 
                'deleted': '➖ 삭제됨', 
                'modified': '✏️ 수정됨', 
                'page-changed': '📄 페이지 변경', 
                'unchanged': '✅ 동일' 
            };
            
            for (var i = 0; i < filteredResults.length; i++) {
                var result = filteredResults[i];
                text += (i + 1) + '. ' + typeLabels[result.type] + (result.severity === 'high' ? ' 🚨 긴급' : '') + '\n';
                if (result.oldItem) text += '   기존: ' + result.oldItem.original + '\n';
                if (result.newItem) text += '   새로: ' + result.newItem.original + '\n';
                if (result.changes && result.changes.length > 0) text += '   변경사항: ' + result.changes.join(', ') + '\n';
                text += '\n';
            }
            
            text += '※ 편집자 수준 목차 비교 분석기에서 생성됨';
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function() {
                    alert(filterLabel + ' 분석 결과가 클립보드에 복사되었습니다! (' + filteredResults.length + '개 항목)');
                }).catch(function() {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }
    </script>
</body>
</html>
