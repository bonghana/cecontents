<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª©ì°¨ ë„êµ¬ í†µí•© í˜ì´ì§€ (ê°œì„ íŒ)</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .header p {
            opacity: 0.9;
            font-size: 1em;
            font-weight: 400;
        }

        .upgrade-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        .tab-navigation {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab-button {
            flex: 1;
            background: none;
            border: none;
            padding: 16px 25px;
            font-size: 1em;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #f1f5f9;
            color: #334155;
        }

        .tab-button.active {
            color: #2c3e50;
            background: white;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            padding: 25px 30px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ìƒ‰ì§€ í˜ì´ì§€ ìƒì„±ê¸° ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .color-page-generator .input-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }

        .color-page-generator .input-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .color-page-generator .input-group {
            margin-bottom: 20px;
        }

        .color-page-generator .input-group:last-child {
            margin-bottom: 0;
        }

        .color-page-generator .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1e293b;
            font-size: 0.95em;
            letter-spacing: -0.01em;
        }

        .color-page-generator .input-group textarea {
            width: 100%;
            min-height: 140px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Pretendard', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
            background: white;
        }

        .color-page-generator .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .color-page-generator .input-group input[type="number"],
        .color-page-generator .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: white;
        }

        .color-page-generator .input-group input[type="number"]:focus,
        .color-page-generator .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .color-page-generator .button-group {
            text-align: center;
            margin-top: 20px;
        }

        .color-page-generator .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 32px;
            border: none;
            border-radius: 40px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
            letter-spacing: -0.01em;
        }

        .color-page-generator .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        .color-page-generator .results-section {
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            margin-top: 25px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .color-page-generator .results-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 18px 25px;
            font-weight: 700;
            font-size: 1.1em;
            letter-spacing: -0.01em;
        }

        .color-page-generator .results-content {
            padding: 20px 25px;
        }

        .color-page-generator .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .color-page-generator .summary-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
            position: relative;
            overflow: hidden;
        }

        .color-page-generator .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(20px, -20px);
        }

        .color-page-generator .summary-card h3 {
            font-size: 1.1em;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .color-page-generator .summary-card .page-numbers {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 8px;
            font-family: 'Pretendard', monospace;
            word-break: break-all;
            line-height: 1.4;
        }

        .color-page-generator .summary-card .page-count {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .color-page-generator .copy-btn-card {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85em;
            backdrop-filter: blur(10px);
        }

        .color-page-generator .copy-btn-card:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .color-page-generator .hidden {
            display: none;
        }

        /* ê°œì„ ëœ ëª©ì°¨ ë¶„ì„ê¸° ìŠ¤íƒ€ì¼ */
        .toc-analyzer .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .toc-analyzer .input-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .toc-analyzer .input-box:focus-within {
            border-color: #2c3e50;
        }

        .toc-analyzer .input-title {
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
        }

        .toc-analyzer .textarea {
            width: 100%;
            height: 180px;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-family: 'Pretendard', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: vertical;
            outline: none;
        }

        .toc-analyzer .textarea:focus {
            border-color: #2c3e50;
            box-shadow: 0 0 0 2px rgba(44, 62, 80, 0.1);
        }

        .toc-analyzer .count {
            margin-top: 8px;
            font-size: 0.8em;
            color: #6c757d;
            font-weight: 500;
        }

        .toc-analyzer .compare-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .toc-analyzer .compare-btn {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toc-analyzer .compare-btn:hover {
            background: #34495e;
        }

        .toc-analyzer .compare-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .toc-analyzer .results {
            display: none;
        }

        .toc-analyzer .results.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .toc-analyzer .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
            background: #f8f9fa;
            padding: 12px 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .toc-analyzer .filter-group {
            display: flex;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }

        .toc-analyzer .filter-btn {
            padding: 8px 16px;
            border: none;
            background: white;
            color: #6c757d;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85em;
        }

        .toc-analyzer .filter-btn.active {
            background: #2c3e50;
            color: white;
        }

        .toc-analyzer .filter-btn:hover:not(.active) {
            background: #f8f9fa;
        }

        .toc-analyzer .summary-stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 0 auto;
            flex: 1;
            max-width: 500px;
        }

        .toc-analyzer .stat-card {
            background: white;
            padding: 10px 12px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: transform 0.3s;
            min-width: 70px;
            flex: 1;
        }

        .toc-analyzer .stat-card:hover {
            transform: translateY(-2px);
        }

        .toc-analyzer .stat-card.total { border-left-color: #007bff; }
        .toc-analyzer .stat-card.added { border-left-color: #28a745; }
        .toc-analyzer .stat-card.deleted { border-left-color: #dc3545; }
        .toc-analyzer .stat-card.modified { border-left-color: #ffc107; }
        .toc-analyzer .stat-card.urgent { border-left-color: #dc3545; background: #fff5f5; }

        .toc-analyzer .stat-number {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 2px;
            color: #495057;
        }

        .toc-analyzer .stat-label {
            font-size: 0.7em;
            color: #6c757d;
            font-weight: 500;
        }

        .toc-analyzer .copy-btn {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .toc-analyzer .copy-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .toc-analyzer .results-list {
            max-height: 65vh;
            overflow-y: auto;
            padding-right: 6px;
        }

        .toc-analyzer .results-list::-webkit-scrollbar {
            width: 5px;
        }

        .toc-analyzer .results-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 6px;
        }

        .toc-analyzer .results-list::-webkit-scrollbar-thumb {
            background: #4facfe;
            border-radius: 6px;
        }

        .toc-analyzer .result-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
            border: 1px solid #e0e0e0;
            transition: all 0.2s;
        }

        .toc-analyzer .result-row:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .toc-analyzer .status-indicator {
            width: 5px;
            min-height: 100%;
            align-self: stretch;
        }

        .toc-analyzer .status-indicator.added { background: #28a745; }
        .toc-analyzer .status-indicator.deleted { background: #dc3545; }
        .toc-analyzer .status-indicator.modified { background: #ffc107; }
        .toc-analyzer .status-indicator.page-changed { background: #007bff; }
        .toc-analyzer .status-indicator.unchanged { background: #6c757d; }

        .toc-analyzer .content-main {
            flex: 1;
            padding: 15px 18px;
        }

        .toc-analyzer .content-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
            line-height: 1.4;
            font-size: 0.95em;
        }

        .toc-analyzer .content-subtitle {
            font-size: 0.8em;
            color: #6c757d;
            line-height: 1.3;
            margin-bottom: 8px;
        }

        /* ê°œì„ ëœ ì°¨ì´ì  í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .diff-container {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            border: 1px solid #e9ecef;
        }

        .diff-line {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Pretendard', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .diff-line.deleted {
            background: #f8d7da;
            border-left: 3px solid #dc3545;
            color: #721c24;
        }

        .diff-line.added {
            background: #d4edda;
            border-left: 3px solid #28a745;
            color: #155724;
        }

        .diff-line.modified {
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            color: #856404;
        }

        /* ì¸ë¼ì¸ ë‹¨ì–´ ë‹¨ìœ„ í•˜ì´ë¼ì´íŒ… */
        .word-diff {
            display: inline;
        }

        .word-removed {
            background: #ffcdd2;
            color: #c62828;
            text-decoration: line-through;
            padding: 1px 3px;
            border-radius: 2px;
            margin: 0 1px;
        }

        .word-added {
            background: #c8e6c9;
            color: #2e7d32;
            padding: 1px 3px;
            border-radius: 2px;
            margin: 0 1px;
            font-weight: 600;
        }

        .word-unchanged {
            color: #333;
        }

        .toc-analyzer .status-badge {
            padding: 6px 12px;
            margin: 12px 12px 12px 0;
            border-radius: 16px;
            font-size: 0.75em;
            font-weight: 600;
            text-align: center;
            min-width: 50px;
            color: white;
        }

        .toc-analyzer .status-badge.added { background: #28a745; }
        .toc-analyzer .status-badge.deleted { background: #dc3545; }
        .toc-analyzer .status-badge.modified { background: #ffc107; color: #1a1a1a; }
        .toc-analyzer .status-badge.page-changed { background: #007bff; }
        .toc-analyzer .status-badge.unchanged { background: #6c757d; }

        .toc-analyzer .no-results {
            text-align: center;
            padding: 50px 20px;
            color: #6c757d;
        }

        .toc-analyzer .no-results-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
        }

        .toc-analyzer .no-results-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 6px;
        }

        /* ìƒˆë¡œìš´ ì°¨ì´ì  ë¶„ì„ ì˜µì…˜ */
        .analysis-options {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .analysis-options h4 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .option-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .option-item input[type="checkbox"] {
            margin: 0;
        }

        .option-item label {
            font-size: 0.85em;
            color: #333;
            cursor: pointer;
            margin: 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 12px;
            }

            .tab-content {
                padding: 20px 15px;
            }

            .tab-button {
                padding: 12px 15px;
                font-size: 0.9em;
            }

            .color-page-generator .input-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .color-page-generator .results-grid {
                grid-template-columns: 1fr;
            }

            .toc-analyzer .input-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .toc-analyzer .controls {
                flex-direction: column;
                gap: 12px;
            }

            .toc-analyzer .summary-stats {
                max-width: 100%;
            }

            .toc-analyzer .stat-card {
                min-width: 60px;
            }

            .option-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ëª©ì°¨ ë„êµ¬ ëª¨ìŒ <span class="upgrade-badge">NEW v2.0</span></h1>
            <p>ì„¸ë°€í•œ ì°¨ì´ì  ë¶„ì„ì„ ì§€ì›í•˜ëŠ” ê³ ê¸‰ ëª©ì°¨ ê´€ë¦¬ ë„êµ¬</p>
        </div>

        <div class="tab-navigation">
            <button class="tab-button active" id="colorPageBtn">
                ğŸ“– ìƒ‰ì§€ í˜ì´ì§€ ìƒì„±ê¸°
            </button>
            <button class="tab-button" id="tocAnalyzerBtn">
                ğŸ” ê³ ê¸‰ ëª©ì°¨ ë¹„êµ ë¶„ì„ê¸°
            </button>
        </div>

        <div id="colorPageTab" class="tab-content active color-page-generator">
            <div class="input-section">
                <div class="input-row">
                    <div class="input-group">
                        <label for="tocInput">ëª©ì°¨ ë‚´ìš© ì…ë ¥</label>
                        <textarea id="tocInput" placeholder="ëª©ì°¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        <div class="example">
                            <div class="example-title">ì…ë ¥ í˜•ì‹ ì˜ˆì‹œ</div>
                            <div><strong>ëŒ€ì œëª©:</strong> â… . ì±•í„°ëª… Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· 1</div>
                            <div><strong>ì¤‘ì œëª©:</strong> 1. ì„¸ë¶€í•­ëª© Â·Â·Â·Â·Â·Â·Â·Â· 5</div>
                            <div><strong>ì†Œì œëª©:</strong> 1) í•˜ìœ„í•­ëª© Â·Â·Â·Â·Â·Â·Â·Â· 10</div>
                            <div style="margin-top: 8px; font-size: 12px; color: #6366f1;">
                                ğŸ’¡ ê³„ì¸µë³„ë¡œ ì„œë¡œ ë‹¤ë¥¸ ê°„ì§€ê°€ í•„ìš”í•œ ê²½ìš° í™œìš©í•˜ì„¸ìš”
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="extraPages">ì¶”ê°€ í˜ì´ì§€ ìˆ˜</label>
                        <input type="number" id="extraPages" placeholder="0" min="0">
                        <div style="font-size: 12px; color: #64748b; margin-top: 6px;">
                            í‘œì§€, ì„œë¬¸ ë“± ëª©ì°¨ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” í˜ì´ì§€
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="separatorCount">ê°„ì§€ ì¢…ë¥˜ ìˆ˜</label>
                        <select id="separatorCount">
                            <option value="1">1ì¢…</option>
                            <option value="2">2ì¢…</option>
                            <option value="3">3ì¢…</option>
                            <option value="4">4ì¢…</option>
                        </select>
                        <div style="font-size: 12px; color: #64748b; margin-top: 6px;">
                            ì„ íƒí•œ ì¢…ë¥˜ ìˆ˜ë§Œí¼ë§Œ ê°„ì§€ ìƒì„±
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn" id="generateBtn">ğŸš€ ìƒ‰ì§€ í˜ì´ì§€ ìƒì„±</button>
                </div>
            </div>

            <div id="results" class="results-section hidden">
                <div class="results-header">
                    ğŸ¯ ìƒì„±ëœ ìƒ‰ì§€ í˜ì´ì§€ ì •ë³´
                </div>
                <div class="results-content" id="resultsContent">
                </div>
            </div>
        </div>

        <div id="tocAnalyzerTab" class="tab-content toc-analyzer">
            <div class="analysis-options">
                <h4>ğŸ”§ ë¶„ì„ ì˜µì…˜</h4>
                <div class="option-group">
                    <div class="option-item">
                        <input type="checkbox" id="wordLevelDiff" checked>
                        <label for="wordLevelDiff">ë‹¨ì–´ ë‹¨ìœ„ ì°¨ì´ì  í•˜ì´ë¼ì´íŒ…</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="showPageChanges" checked>
                        <label for="showPageChanges">í˜ì´ì§€ ë²ˆí˜¸ ë³€ê²½ì‚¬í•­ ê°•ì¡°</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="strictMatching">
                        <label for="strictMatching">ì—„ê²©í•œ ë§¤ì¹­ ëª¨ë“œ</label>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="input-box">
                    <div class="input-title">ğŸ“„ ê¸°ì¡´ ëª©ì°¨</div>
                    <textarea id="oldTOC" class="textarea" placeholder="ê¸°ì¡´ ëª©ì°¨ë¥¼ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”"></textarea>
                    <div class="count" id="oldCount">0ì¤„</div>
                </div>
                <div class="input-box">
                    <div class="input-title">ğŸ“ ìƒˆë¡œìš´ ëª©ì°¨</div>
                    <textarea id="newTOC" class="textarea" placeholder="ìƒˆë¡œìš´ ëª©ì°¨ë¥¼ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”"></textarea>
                    <div class="count" id="newCount">0ì¤„</div>
                </div>
            </div>
            <div class="compare-section">
                <button class="compare-btn" id="compareBtn">ğŸ” ê³ ê¸‰ ëª©ì°¨ ë¹„êµ ë¶„ì„ ì‹œì‘</button>
            </div>
            <div class="results" id="analyzerResults">
                <div class="controls">
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="changes">ë³€ê²½ì‚¬í•­</button>
                        <button class="filter-btn" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn" data-filter="urgent">ê¸´ê¸‰ê²€í† </button>
                    </div>
                    <div class="summary-stats">
                        <div class="stat-card total"><div class="stat-number" id="totalCount">0</div><div class="stat-label">ì´ í•­ëª©</div></div>
                        <div class="stat-card added"><div class="stat-number" id="addedCount">0</div><div class="stat-label">â• ì¶”ê°€</div></div>
                        <div class="stat-card deleted"><div class="stat-number" id="deletedCount">0</div><div class="stat-label">â– ì‚­ì œ</div></div>
                        <div class="stat-card modified"><div class="stat-number" id="modifiedCount">0</div><div class="stat-label">âœï¸ ìˆ˜ì •</div></div>
                        <div class="stat-card urgent"><div class="stat-number" id="urgentCount">0</div><div class="stat-label">ğŸš¨ ê¸´ê¸‰</div></div>
                    </div>
                    <button class="copy-btn" id="copyAnalyzerBtn">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
                </div>
                <div class="results-list" id="resultsList"></div>
            </div>
        </div>
    </div>

    <script>
        var analysisResults = [];
        var currentFilter = 'changes';

        document.addEventListener('DOMContentLoaded', function() {
            var colorPageBtn = document.getElementById('colorPageBtn');
            var tocAnalyzerBtn = document.getElementById('tocAnalyzerBtn');
            
            if (colorPageBtn) {
                colorPageBtn.addEventListener('click', function() {
                    switchTab('colorPage');
                });
            }
            
            if (tocAnalyzerBtn) {
                tocAnalyzerBtn.addEventListener('click', function() {
                    switchTab('tocAnalyzer');
                });
            }

            var generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.addEventListener('click', generateColorPages);
            }

            var oldTOC = document.getElementById('oldTOC');
            var newTOC = document.getElementById('newTOC');
            var compareBtn = document.getElementById('compareBtn');
            var copyAnalyzerBtn = document.getElementById('copyAnalyzerBtn');
            
            if (oldTOC) {
                oldTOC.addEventListener('input', function() {
                    updateLineCount('oldTOC', 'oldCount');
                });
                updateLineCount('oldTOC', 'oldCount');
            }
            
            if (newTOC) {
                newTOC.addEventListener('input', function() {
                    updateLineCount('newTOC', 'newCount');
                });
                updateLineCount('newTOC', 'newCount');
            }
            
            if (compareBtn) {
                compareBtn.addEventListener('click', startComparison);
            }
            
            if (copyAnalyzerBtn) {
                copyAnalyzerBtn.addEventListener('click', copyAnalyzerResults);
            }

            var filterBtns = document.querySelectorAll('.toc-analyzer .filter-btn');
            filterBtns.forEach(function(btn) {
                btn.addEventListener('click', function(e) {
                    setFilter(e.target.dataset.filter);
                });
            });
        });

        function switchTab(tabName) {
            var tabButtons = document.querySelectorAll('.tab-button');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            var tabContents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            if (tabName === 'colorPage') {
                document.getElementById('colorPageBtn').classList.add('active');
                document.getElementById('colorPageTab').classList.add('active');
            } else if (tabName === 'tocAnalyzer') {
                document.getElementById('tocAnalyzerBtn').classList.add('active');
                document.getElementById('tocAnalyzerTab').classList.add('active');
            }
        }

        // ìƒ‰ì§€ í˜ì´ì§€ ìƒì„±ê¸° í•¨ìˆ˜ë“¤ (ê¸°ì¡´ê³¼ ë™ì¼)
        function generateColorPages() {
            var tocInput = document.getElementById('tocInput').value.trim();
            var extraPages = parseInt(document.getElementById('extraPages').value) || 0;
            
            if (!tocInput) {
                alert('ëª©ì°¨ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                var chapters = parseTOC(tocInput);
                var colorPagesByType = calculateColorPages(chapters, extraPages);
                displayResults(colorPagesByType, chapters, extraPages);
            } catch (error) {
                alert('ëª©ì°¨ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function parseTOC(tocText) {
            var lines = tocText.split('\n').filter(function(line) { return line.trim(); });
            var chapters = [];
            var currentChapter = null;

            for (var i = 0; i < lines.length; i++) {
                var line = lines[i];
                var trimmedLine = line.trim();
                
                var pageMatch = null;
                
                pageMatch = trimmedLine.match(/^(.+?)\s{2,}(\d+)\s*$/);
                if (!pageMatch) {
                    pageMatch = trimmedLine.match(/^(.+?)[Â·\.]{2,}\s*(\d+)\s*$/);
                }
                if (!pageMatch) {
                    pageMatch = trimmedLine.match(/^(.+?)[-]{2,}\s*(\d+)\s*$/);
                }
                if (!pageMatch) {
                    pageMatch = trimmedLine.match(/^(.+?)[~]{2,}\s*(\d+)\s*$/);
                }
                
                if (trimmedLine.match(/^\d+\s*$/) && trimmedLine.length < 4) {
                    continue;
                }
                
                if (pageMatch) {
                    var pageNumber = parseInt(pageMatch[2]);
                    var title = pageMatch[1].trim();
                    
                    title = title.replace(/^[\s\d\.\-\*]+/, '').trim();
                    title = title.replace(/\*\*/g, '').trim();
                    
                    var level = 1;
                    var originalTitle = pageMatch[1].trim();
                    
                    if (/^\*\*.*\*\*/.test(originalTitle)) {
                        level = 1;
                    } else if (/^[â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«]+\./.test(originalTitle)) {
                        level = 1;
                    } else if (/^\d+\s/.test(originalTitle) && !/^\d+-\d+/.test(originalTitle)) {
                        level = 1;
                    } else if (/^\d+\./.test(originalTitle) && !/^\d+-\d+\./.test(originalTitle)) {
                        level = 1;
                    } else if (/^\d+-\d+\./.test(originalTitle)) {
                        level = 2;
                    } else if (/^\s+\d+\./.test(originalTitle)) {
                        level = 2;
                    } else if (/^\d+\)/.test(originalTitle)) {
                        level = 3;
                    } else if (/^\(\d+\)/.test(originalTitle)) {
                        level = 3;
                    } else if (/^\([ê°€-í£]+\)/.test(originalTitle)) {
                        level = 4;
                    } else if (/^\(\s*ì°¸ê³ \s*\)/.test(originalTitle)) {
                        level = 2;
                    } else {
                        var indentLevel = (line.length - line.trimLeft().length);
                        if (indentLevel >= 4) {
                            level = 2;
                        } else {
                            level = 1;
                        }
                    }
                    
                    var chapterNumber = chapters.length + 1;
                    
                    currentChapter = {
                        number: chapterNumber,
                        title: title,
                        page: pageNumber,
                        level: level,
                        subtitles: [],
                        originalLine: line
                    };
                    chapters.push(currentChapter);
                } else if (trimmedLine.startsWith('-') && currentChapter) {
                    var subtitle = trimmedLine.substring(1).trim();
                    currentChapter.subtitles.push(subtitle);
                }
            }

            if (chapters.length === 0) {
                throw new Error('í˜ì´ì§€ ë²ˆí˜¸ê°€ í¬í•¨ëœ ëª©ì°¨ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }

            return chapters;
        }

        function calculateColorPages(chapters, extraPages) {
            var separatorCount = parseInt(document.getElementById('separatorCount').value) || 1;
            var colorPagesByType = {};
            
            for (var type = 1; type <= separatorCount; type++) {
                colorPagesByType['ê°„ì§€' + type] = [];
            }

            for (var i = 0; i < chapters.length; i++) {
                var chapter = chapters[i];
                
                if (chapter.level <= separatorCount) {
                    var tocColorPage = chapter.page;
                    var actualColorPage = tocColorPage + extraPages;
                    
                    var separatorType = 'ê°„ì§€' + chapter.level;
                    
                    colorPagesByType[separatorType].push({
                        colorPage: actualColorPage,
                        chapterTitle: chapter.title,
                        chapterNumber: chapter.number,
                        tocColorPage: tocColorPage,
                        subtitles: chapter.subtitles,
                        level: chapter.level
                    });
                }
            }

            return colorPagesByType;
        }

        function displayResults(colorPagesByType, chapters, extraPages) {
            var resultsContent = document.getElementById('resultsContent');
            var results = document.getElementById('results');
            
            var html = '';
            var allSeparatorData = [];
            
            html += '<div class="results-grid">';
            for (var separatorType in colorPagesByType) {
                var items = colorPagesByType[separatorType];
                if (items.length > 0) {
                    var pageNumbers = items.map(function(item) { return item.colorPage; }).sort(function(a, b) { return a - b; });
                    
                    allSeparatorData.push({
                        type: separatorType,
                        pages: pageNumbers,
                        count: pageNumbers.length
                    });
                    
                    html += '<div class="summary-card">';
                    html += '<h3>ğŸ“‹ ' + separatorType + '</h3>';
                    html += '<div class="page-numbers" id="colorPageResult' + separatorType + '">' + pageNumbers.join(', ') + '</div>';
                    html += '<div class="page-count">ì´ ' + pageNumbers.length + 'í˜ì´ì§€</div>';
                    html += '<button class="copy-btn-card copy-specific-btn" data-type="' + separatorType + '">ğŸ“‹ ë³µì‚¬</button>';
                    html += '</div>';
                }
            }
            html += '</div>';

            resultsContent.innerHTML = html;
            results.classList.remove('hidden');
            
            setupResultsEventListeners(allSeparatorData);
            
            setTimeout(function() {
                results.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function setupResultsEventListeners(allSeparatorData) {
            var copySpecificBtns = document.querySelectorAll('.copy-specific-btn');
            for (var i = 0; i < copySpecificBtns.length; i++) {
                copySpecificBtns[i].addEventListener('click', function(e) {
                    var separatorType = e.target.getAttribute('data-type');
                    copySpecificResult(separatorType, e.target);
                });
            }
        }

        function copySpecificResult(separatorType, button) {
            var resultElement = document.getElementById('colorPageResult' + separatorType);
            if (!resultElement) {
                alert('ë³µì‚¬í•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            var pageNumbers = resultElement.textContent.trim();
            var copyText = separatorType + ' ê°„ì§€í˜ì´ì§€(PDF): ' + pageNumbers + ' (ì´ ' + pageNumbers.split(', ').length + 'í˜ì´ì§€)';
            
            copyToClipboard(copyText, button);
        }

        function copyToClipboard(text, button) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function() {
                    var originalText = button.textContent;
                    var originalBg = button.style.background;
                    button.textContent = 'âœ… ë³µì‚¬ì™„ë£Œ!';
                    button.style.background = 'rgba(40, 167, 69, 0.9)';
                    
                    setTimeout(function() {
                        button.textContent = originalText;
                        button.style.background = originalBg;
                    }, 1500);
                }).catch(function() {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            var textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function updateLineCount(textareaId, countId) {
            var textarea = document.getElementById(textareaId);
            var countElement = document.getElementById(countId);
            if (textarea && countElement) {
                var lines = textarea.value.split('\n').filter(function(line) { return line.trim().length > 0; });
                countElement.textContent = lines.length + 'ì¤„';
            }
        }

        // ê°œì„ ëœ ëª©ì°¨ ë¶„ì„ í•¨ìˆ˜ë“¤
        function parseTOCForAnalysis(text) {
            if (!text.trim()) return [];
            var lines = text.split('\n')
                .map(function(line) { return line.trim(); })
                .filter(function(line) { return line.length > 0; });
            
            return lines.map(function(line, index) {
                var trimmed = line.trim();
                var patterns = [
                    /^(.+?)\s*[\.]{2,}\s*(\d+)$/, 
                    /^(.+?)\s{3,}(\d+)$/, 
                    /^(.+?)\s*[-~]\s*(\d+)$/
                ];
                var title = '', page = '';
                for (var i = 0; i < patterns.length; i++) {
                    var match = trimmed.match(patterns[i]);
                    if (match) { 
                        title = match[1].trim(); 
                        page = match[2]; 
                        break; 
                    }
                }
                if (!title) title = trimmed;
                title = title.replace(/^[\d\.\-\s]*/, '').trim().replace(/[\.]{2,}$/, '').trim();
                return { index: index, title: title, page: page, original: trimmed };
            });
        }

        function calculateSimilarity(str1, str2) {
            if (str1 === str2) return 1.0;
            var longer = str1.length > str2.length ? str1 : str2;
            var shorter = str1.length > str2.length ? str2 : str1;
            if (longer.length === 0) return 1.0;
            var distance = levenshteinDistance(longer, shorter);
            return (longer.length - distance) / longer.length;
        }

        function levenshteinDistance(str1, str2) {
            var matrix = [];
            for (var i = 0; i <= str2.length; i++) {
                matrix[i] = [];
                for (var j = 0; j <= str1.length; j++) {
                    matrix[i][j] = 0;
                }
            }
            
            for (var i = 0; i <= str1.length; i++) matrix[0][i] = i;
            for (var j = 0; j <= str2.length; j++) matrix[j][0] = j;
            
            for (var j = 1; j <= str2.length; j++) {
                for (var i = 1; i <= str1.length; i++) {
                    if (str1[i - 1] === str2[j - 1]) {
                        matrix[j][i] = matrix[j - 1][i - 1];
                    } else {
                        matrix[j][i] = Math.min(
                            matrix[j - 1][i - 1] + 1,
                            matrix[j][i - 1] + 1,
                            matrix[j - 1][i] + 1
                        );
                    }
                }
            }
            return matrix[str2.length][str1.length];
        }

        // ìƒˆë¡œìš´ ë‹¨ì–´ ë‹¨ìœ„ ì°¨ì´ì  ë¶„ì„ í•¨ìˆ˜
        function getWordLevelDiff(oldText, newText) {
            var oldWords = oldText.split(/(\s+)/);
            var newWords = newText.split(/(\s+)/);
            var result = [];
            
            var dp = [];
            for (var i = 0; i <= oldWords.length; i++) {
                dp[i] = [];
                for (var j = 0; j <= newWords.length; j++) {
                    dp[i][j] = 0;
                }
            }
            
            // LCS ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë‹¨ì–´ ë‹¨ìœ„ ì°¨ì´ì  ê³„ì‚°
            for (var i = 1; i <= oldWords.length; i++) {
                for (var j = 1; j <= newWords.length; j++) {
                    if (oldWords[i-1] === newWords[j-1]) {
                        dp[i][j] = dp[i-1][j-1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i-1][j], dp[i][j-1]);
                    }
                }
            }
            
            // ì—­ì¶”ì ìœ¼ë¡œ ì°¨ì´ì  ì°¾ê¸°
            var i = oldWords.length, j = newWords.length;
            var oldResult = [], newResult = [];
            
            while (i > 0 || j > 0) {
                if (i > 0 && j > 0 && oldWords[i-1] === newWords[j-1]) {
                    oldResult.unshift({word: oldWords[i-1], type: 'unchanged'});
                    newResult.unshift({word: newWords[j-1], type: 'unchanged'});
                    i--; j--;
                } else if (i > 0 && (j === 0 || dp[i-1][j] >= dp[i][j-1])) {
                    oldResult.unshift({word: oldWords[i-1], type: 'removed'});
                    i--;
                } else {
                    newResult.unshift({word: newWords[j-1], type: 'added'});
                    j--;
                }
            }
            
            return {old: oldResult, new: newResult};
        }

        function renderWordDiff(diffData) {
            var html = '';
            
            if (diffData.old.length > 0) {
                html += '<div class="diff-line deleted">';
                for (var i = 0; i < diffData.old.length; i++) {
                    var word = diffData.old[i];
                    var className = 'word-' + (word.type === 'unchanged' ? 'unchanged' : 'removed');
                    html += '<span class="' + className + '">' + word.word + '</span>';
                }
                html += '</div>';
            }
            
            if (diffData.new.length > 0) {
                html += '<div class="diff-line added">';
                for (var i = 0; i < diffData.new.length; i++) {
                    var word = diffData.new[i];
                    var className = 'word-' + (word.type === 'unchanged' ? 'unchanged' : 'added');
                    html += '<span class="' + className + '">' + word.word + '</span>';
                }
                html += '</div>';
            }
            
            return html;
        }

        function compareItems(oldItems, newItems) {
            var results = [];
            var usedOld = [];
            var usedNew = [];
            var isWordLevel = document.getElementById('wordLevelDiff').checked;
            var strictMode = document.getElementById('strictMatching').checked;
            
            // ìŠ¤ë§ˆíŠ¸ ë§¤ì¹­: ë” ê´€ëŒ€í•œ ì„ê³„ê°’ ì‚¬ìš© (ê¸°ë³¸ 0.3, ì—„ê²© ëª¨ë“œ 0.6)
            var primaryThreshold = strictMode ? 0.6 : 0.3;
            var secondaryThreshold = strictMode ? 0.9 : 0.7; // ì •í™•í•œ ë§¤ì¹­ìš©
            
            // 1ë‹¨ê³„: ì •í™•í•œ ë§¤ì¹­
            for (var oldIndex = 0; oldIndex < oldItems.length; oldIndex++) {
                for (var newIndex = 0; newIndex < newItems.length; newIndex++) {
                    if (usedOld[oldIndex] || usedNew[newIndex]) continue;
                    
                    var oldItem = oldItems[oldIndex];
                    var newItem = newItems[newIndex];
                    
                    if (oldItem.title === newItem.title) {
                        usedOld[oldIndex] = true;
                        usedNew[newIndex] = true;
                        var changes = [];
                        var diffHtml = '';
                        
                        if (oldItem.page !== newItem.page && oldItem.page && newItem.page) {
                            changes.push('í˜ì´ì§€ ' + oldItem.page + ' â†’ ' + newItem.page);
                        }
                        
                        if (oldItem.original !== newItem.original && isWordLevel) {
                            var wordDiff = getWordLevelDiff(oldItem.original, newItem.original);
                            diffHtml = renderWordDiff(wordDiff);
                        }
                        
                        results.push({ 
                            type: changes.length > 0 ? 'page-changed' : 'unchanged', 
                            oldItem: oldItem, 
                            newItem: newItem, 
                            changes: changes, 
                            severity: 'low', 
                            position: oldIndex,
                            diffHtml: diffHtml
                        });
                        break;
                    }
                }
            }
            
            // 2ë‹¨ê³„: ë†’ì€ ìœ ì‚¬ë„ ë§¤ì¹­ (ì •í™•í•œ ë§¤ì¹­ê¸‰)
            for (var oldIndex = 0; oldIndex < oldItems.length; oldIndex++) {
                if (usedOld[oldIndex]) continue;
                
                var bestMatch = null;
                var bestSimilarity = 0;
                var bestNewIndex = -1;
                
                for (var newIndex = 0; newIndex < newItems.length; newIndex++) {
                    if (usedNew[newIndex]) continue;
                    
                    var similarity = calculateSimilarity(
                        oldItems[oldIndex].title.toLowerCase(), 
                        newItems[newIndex].title.toLowerCase()
                    );
                    
                    if (similarity > bestSimilarity && similarity > secondaryThreshold) {
                        bestMatch = newItems[newIndex];
                        bestSimilarity = similarity;
                        bestNewIndex = newIndex;
                    }
                }
                
                if (bestMatch) {
                    usedOld[oldIndex] = true;
                    usedNew[bestNewIndex] = true;
                    var changes = [];
                    var diffHtml = '';
                    
                    // í˜ì´ì§€ ë³€ê²½ì‚¬í•­ ì²´í¬
                    if (oldItems[oldIndex].page !== bestMatch.page && oldItems[oldIndex].page && bestMatch.page) {
                        changes.push('í˜ì´ì§€ ' + oldItems[oldIndex].page + ' â†’ ' + bestMatch.page);
                    }
                    
                    // ë‚´ìš© ë³€ê²½ì‚¬í•­ ì²´í¬
                    if (oldItems[oldIndex].original !== bestMatch.original) {
                        changes.push('ë‚´ìš© ìˆ˜ì •');
                        if (isWordLevel) {
                            var wordDiff = getWordLevelDiff(oldItems[oldIndex].original, bestMatch.original);
                            diffHtml = renderWordDiff(wordDiff);
                        }
                    }
                    
                    results.push({ 
                        type: 'modified', 
                        oldItem: oldItems[oldIndex], 
                        newItem: bestMatch, 
                        changes: changes.length > 0 ? changes : ['ë¯¸ì„¸í•œ ë³€ê²½'], 
                        severity: 'medium', 
                        position: Math.min(oldIndex, bestNewIndex),
                        diffHtml: diffHtml
                    });
                }
            }
            
            // 3ë‹¨ê³„: ê´€ëŒ€í•œ ìœ ì‚¬ë„ ë§¤ì¹­ (ì‚­ì œ/ì¶”ê°€ë¥¼ ìµœëŒ€í•œ ìˆ˜ì •ìœ¼ë¡œ ë³€í™˜)
            for (var oldIndex = 0; oldIndex < oldItems.length; oldIndex++) {
                if (usedOld[oldIndex]) continue;
                
                var bestMatch = null;
                var bestSimilarity = 0;
                var bestNewIndex = -1;
                
                for (var newIndex = 0; newIndex < newItems.length; newIndex++) {
                    if (usedNew[newIndex]) continue;
                    
                    // ë‹¤ì¤‘ ìœ ì‚¬ë„ ê³„ì‚°
                    var titleSim = calculateSimilarity(
                        oldItems[oldIndex].title.toLowerCase(), 
                        newItems[newIndex].title.toLowerCase()
                    );
                    
                    var originalSim = calculateSimilarity(
                        oldItems[oldIndex].original.toLowerCase(), 
                        newItems[newIndex].original.toLowerCase()
                    );
                    
                    // í‚¤ì›Œë“œ ê¸°ë°˜ ìœ ì‚¬ë„ë„ ê³ ë ¤
                    var keywordSim = calculateKeywordSimilarity(
                        oldItems[oldIndex].original, 
                        newItems[newIndex].original
                    );
                    
                    // ìµœì¢… ìœ ì‚¬ë„: ê°€ì¤‘ í‰ê· 
                    var finalSim = Math.max(titleSim, originalSim, keywordSim);
                    
                    if (finalSim > bestSimilarity && finalSim > primaryThreshold) {
                        bestMatch = newItems[newIndex];
                        bestSimilarity = finalSim;
                        bestNewIndex = newIndex;
                    }
                }
                
                if (bestMatch) {
                    usedOld[oldIndex] = true;
                    usedNew[bestNewIndex] = true;
                    var changes = ['ëŒ€í­ ìˆ˜ì •'];
                    var diffHtml = '';
                    
                    if (isWordLevel) {
                        var wordDiff = getWordLevelDiff(oldItems[oldIndex].original, bestMatch.original);
                        diffHtml = renderWordDiff(wordDiff);
                    }
                    
                    results.push({ 
                        type: 'modified', 
                        oldItem: oldItems[oldIndex], 
                        newItem: bestMatch, 
                        changes: changes, 
                        severity: 'medium', 
                        position: Math.min(oldIndex, bestNewIndex),
                        diffHtml: diffHtml
                    });
                }
            }
            
            // 4ë‹¨ê³„: ì •ë§ ë‚¨ì€ ê²ƒë“¤ë§Œ ì‚­ì œ/ì¶”ê°€ë¡œ ë¶„ë¥˜
            for (var oldIndex = 0; oldIndex < oldItems.length; oldIndex++) {
                if (!usedOld[oldIndex]) {
                    results.push({ 
                        type: 'deleted', 
                        oldItem: oldItems[oldIndex], 
                        newItem: null, 
                        changes: ['ì™„ì „ ì‚­ì œë¨'], 
                        severity: 'high', 
                        position: oldIndex,
                        diffHtml: ''
                    });
                }
            }
            
            for (var newIndex = 0; newIndex < newItems.length; newIndex++) {
                if (!usedNew[newIndex]) {
                    results.push({ 
                        type: 'added', 
                        oldItem: null, 
                        newItem: newItems[newIndex], 
                        changes: ['ì™„ì „ ìƒˆë¡œìš´ í•­ëª©'], 
                        severity: 'medium', 
                        position: newIndex,
                        diffHtml: ''
                    });
                }
            }
            
            return results.sort(function(a, b) { return a.position - b.position; });
        }

        // í‚¤ì›Œë“œ ê¸°ë°˜ ìœ ì‚¬ë„ ê³„ì‚° í•¨ìˆ˜ ì¶”ê°€
        function calculateKeywordSimilarity(text1, text2) {
            // ê³µí†µ í‚¤ì›Œë“œ ì¶”ì¶œ
            var words1 = text1.toLowerCase().replace(/[^\w\sê°€-í£]/g, ' ').split(/\s+/).filter(function(w) { return w.length > 1; });
            var words2 = text2.toLowerCase().replace(/[^\w\sê°€-í£]/g, ' ').split(/\s+/).filter(function(w) { return w.length > 1; });
            
            if (words1.length === 0 && words2.length === 0) return 1.0;
            if (words1.length === 0 || words2.length === 0) return 0.0;
            
            var commonWords = 0;
            var totalWords = Math.max(words1.length, words2.length);
            
            for (var i = 0; i < words1.length; i++) {
                if (words2.indexOf(words1[i]) !== -1) {
                    commonWords++;
                }
            }
            
            return commonWords / totalWords;
        }

        function startComparison() {
            var oldTOC = document.getElementById('oldTOC');
            var newTOC = document.getElementById('newTOC');
            var compareBtn = document.getElementById('compareBtn');
            
            var oldText = oldTOC.value;
            var newText = newTOC.value;
            
            if (!oldText.trim() || !newText.trim()) { 
                alert('ê¸°ì¡´ ëª©ì°¨ì™€ ìƒˆë¡œìš´ ëª©ì°¨ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); 
                return; 
            }
            
            compareBtn.disabled = true;
            compareBtn.textContent = 'ğŸ”„ ë¶„ì„ì¤‘...';
            
            setTimeout(function() {
                try {
                    var oldItems = parseTOCForAnalysis(oldText);
                    var newItems = parseTOCForAnalysis(newText);
                    analysisResults = compareItems(oldItems, newItems);
                    displayAnalysisResults();
                } catch (error) {
                    alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                } finally {
                    compareBtn.disabled = false;
                    compareBtn.textContent = 'ğŸ” ê³ ê¸‰ ëª©ì°¨ ë¹„êµ ë¶„ì„ ì‹œì‘';
                }
            }, 500);
        }

        function displayAnalysisResults() {
            var resultsDiv = document.getElementById('analyzerResults');
            resultsDiv.classList.add('show');
            
            var stats = {
                total: analysisResults.length,
                added: 0,
                deleted: 0,
                modified: 0,
                urgent: 0
            };
            
            for (var i = 0; i < analysisResults.length; i++) {
                var result = analysisResults[i];
                if (result.type === 'added') stats.added++;
                if (result.type === 'deleted') stats.deleted++;
                if (result.type === 'modified' || result.type === 'page-changed') stats.modified++;
                if (result.severity === 'high') stats.urgent++;
            }
            
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('addedCount').textContent = stats.added;
            document.getElementById('deletedCount').textContent = stats.deleted;
            document.getElementById('modifiedCount').textContent = stats.modified;
            document.getElementById('urgentCount').textContent = stats.urgent;
            
            updateResultsList();
        }

        function setFilter(filter) {
            currentFilter = filter;
            var filterBtns = document.querySelectorAll('.toc-analyzer .filter-btn');
            for (var i = 0; i < filterBtns.length; i++) {
                filterBtns[i].classList.remove('active');
            }
            var targetBtn = document.querySelector('.toc-analyzer [data-filter="' + filter + '"]');
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            updateResultsList();
        }

        function updateResultsList() {
            var resultsListDiv = document.getElementById('resultsList');
            var filteredResults = analysisResults;
            
            if (currentFilter === 'changes') {
                filteredResults = analysisResults.filter(function(r) { return r.type !== 'unchanged'; });
            } else if (currentFilter === 'urgent') {
                filteredResults = analysisResults.filter(function(r) { return r.severity === 'high'; });
            }
            
            if (filteredResults.length === 0) {
                resultsListDiv.innerHTML = '<div class="no-results"><div class="no-results-icon">âœ…</div><div class="no-results-title">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div></div>';
                return;
            }
            
            var html = '';
            var typeLabels = {
                'added': 'ì‹ ê·œ',
                'deleted': 'ì‚­ì œ', 
                'modified': 'ìˆ˜ì •',
                'page-changed': 'í˜ì´ì§€ë³€ê²½',
                'unchanged': 'ë™ì¼'
            };
            
            for (var i = 0; i < filteredResults.length; i++) {
                var result = filteredResults[i];
                var mainContent = '';
                var subContent = '';
                
                if (result.type === 'added') {
                    mainContent = '<span class="content-single">' + result.newItem.original + '</span>';
                    subContent = 'ìƒˆë¡œ ì¶”ê°€ëœ í•­ëª©ì…ë‹ˆë‹¤';
                } else if (result.type === 'deleted') {
                    mainContent = '<span class="content-single deleted">' + result.oldItem.original + '</span>';
                    subContent = 'ì‚­ì œëœ í•­ëª©ì…ë‹ˆë‹¤';
                } else if (result.type === 'modified' || result.type === 'page-changed') {
                    if (result.diffHtml) {
                        mainContent = '<div class="diff-container">' + result.diffHtml + '</div>';
                    } else {
                        mainContent = '<div class="diff-line deleted">' + result.oldItem.original + '</div>';
                        mainContent += '<div class="diff-line added">' + result.newItem.original + '</div>';
                    }
                    subContent = result.changes ? result.changes.join(' â€¢ ') : 'ë‚´ìš©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤';
                } else {
                    mainContent = '<span class="content-single">' + result.oldItem.original + '</span>';
                    subContent = 'ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤';
                }
                
                html += '<div class="result-row">';
                html += '<div class="status-indicator ' + result.type + '"></div>';
                html += '<div class="content-main">';
                html += '<div class="content-title">' + mainContent + '</div>';
                html += '<div class="content-subtitle">' + subContent + '</div>';
                html += '</div>';
                html += '<div class="status-badge ' + result.type + '">' + typeLabels[result.type] + '</div>';
                html += '</div>';
            }
            
            resultsListDiv.innerHTML = html;
        }

        function copyAnalyzerResults() {
            if (analysisResults.length === 0) { 
                alert('ë¹„êµ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'); 
                return; 
            }
            
            var filteredResults = analysisResults;
            var filterLabel = 'ì „ì²´';
            
            if (currentFilter === 'changes') {
                filteredResults = analysisResults.filter(function(r) { return r.type !== 'unchanged'; });
                filterLabel = 'ë³€ê²½ì‚¬í•­';
            } else if (currentFilter === 'urgent') {
                filteredResults = analysisResults.filter(function(r) { return r.severity === 'high'; });
                filterLabel = 'ê¸´ê¸‰ê²€í† ';
            }
            
            if (filteredResults.length === 0) {
                alert('í˜„ì¬ í•„í„°ì— í•´ë‹¹í•˜ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            var text = 'ê³ ê¸‰ ëª©ì°¨ ë¹„êµ ë¶„ì„ ê²°ê³¼ (' + filterLabel + ')\nìƒì„±ì¼ì‹œ: ' + new Date().toLocaleString('ko-KR') + '\n\n';
            
            var typeLabels = { 
                'added': 'â• ì¶”ê°€ë¨', 
                'deleted': 'â– ì‚­ì œë¨', 
                'modified': 'âœï¸ ìˆ˜ì •ë¨', 
                'page-changed': 'ğŸ“„ í˜ì´ì§€ ë³€ê²½', 
                'unchanged': 'âœ… ë™ì¼' 
            };
            
            for (var i = 0; i < filteredResults.length; i++) {
                var result = filteredResults[i];
                text += (i + 1) + '. ' + typeLabels[result.type] + (result.severity === 'high' ? ' ğŸš¨ ê¸´ê¸‰' : '') + '\n';
                if (result.oldItem) text += '   ê¸°ì¡´: ' + result.oldItem.original + '\n';
                if (result.newItem) text += '   ìƒˆë¡œ: ' + result.newItem.original + '\n';
                if (result.changes && result.changes.length > 0) text += '   ë³€ê²½ì‚¬í•­: ' + result.changes.join(', ') + '\n';
                text += '\n';
            }
            
            text += 'â€» ê³ ê¸‰ ëª©ì°¨ ë¹„êµ ë¶„ì„ê¸° v2.0ì—ì„œ ìƒì„±ë¨ (ë‹¨ì–´ ë‹¨ìœ„ ì°¨ì´ì  ë¶„ì„ í¬í•¨)';
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(function() {
                    alert(filterLabel + ' ë¶„ì„ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (' + filteredResults.length + 'ê°œ í•­ëª©)');
                }).catch(function() {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }
    </script>
</body>
</html>
